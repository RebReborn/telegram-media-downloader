{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.MTProtoPlainSender = void 0;\n/**\n *  This module contains the class used to communicate with Telegram's servers\n *  in plain text, when no authorization key has been created yet.\n */\nconst big_integer_1 = __importDefault(require(\"big-integer\"));\nconst MTProtoState_1 = require(\"./MTProtoState\");\nconst Helpers_1 = require(\"../Helpers\");\nconst errors_1 = require(\"../errors\");\nconst extensions_1 = require(\"../extensions\");\n/**\n * MTProto Mobile Protocol plain sender (https://core.telegram.org/mtproto/description#unencrypted-messages)\n */\nclass MTProtoPlainSender {\n  /**\n   * Initializes the MTProto plain sender.\n   * @param connection connection: the Connection to be used.\n   * @param loggers\n   */\n  constructor(connection, loggers) {\n    this._state = new MTProtoState_1.MTProtoState(undefined, loggers);\n    this._connection = connection;\n  }\n  /**\n   * Sends and receives the result for the given request.\n   * @param request\n   */\n  async send(request) {\n    let body = request.getBytes();\n    let msgId = this._state._getNewMsgId();\n    const m = (0, Helpers_1.toSignedLittleBuffer)(msgId, 8);\n    const b = Buffer.alloc(4);\n    b.writeInt32LE(body.length, 0);\n    const res = Buffer.concat([Buffer.concat([Buffer.alloc(8), m, b]), body]);\n    await this._connection.send(res);\n    body = await this._connection.recv();\n    if (body.length < 8) {\n      throw new errors_1.InvalidBufferError(body);\n    }\n    const reader = new extensions_1.BinaryReader(body);\n    const authKeyId = reader.readLong();\n    if (authKeyId.neq((0, big_integer_1.default)(0))) {\n      throw new Error(\"Bad authKeyId\");\n    }\n    msgId = reader.readLong();\n    if (msgId.eq((0, big_integer_1.default)(0))) {\n      throw new Error(\"Bad msgId\");\n    }\n    /** ^ We should make sure that the read ``msg_id`` is greater\n     * than our own ``msg_id``. However, under some circumstances\n     * (bad system clock/working behind proxies) this seems to not\n     * be the case, which would cause endless assertion errors.\n     */\n    const length = reader.readInt();\n    if (length <= 0) {\n      throw new Error(\"Bad length\");\n    }\n    /**\n     * We could read length bytes and use those in a new reader to read\n     * the next TLObject without including the padding, but since the\n     * reader isn't used for anything else after this, it's unnecessary.\n     */\n    return reader.tgReadObject();\n  }\n}\nexports.MTProtoPlainSender = MTProtoPlainSender;","map":{"version":3,"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","MTProtoPlainSender","big_integer_1","require","MTProtoState_1","Helpers_1","errors_1","extensions_1","constructor","connection","loggers","_state","MTProtoState","undefined","_connection","send","request","body","getBytes","msgId","_getNewMsgId","m","toSignedLittleBuffer","b","Buffer","alloc","writeInt32LE","length","res","concat","recv","InvalidBufferError","reader","BinaryReader","authKeyId","readLong","neq","default","Error","eq","readInt","tgReadObject"],"sources":["C:/Users/Rodrick/Documents/telegram-media-downloader/node_modules/telegram/network/MTProtoPlainSender.js"],"sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.MTProtoPlainSender = void 0;\n/**\n *  This module contains the class used to communicate with Telegram's servers\n *  in plain text, when no authorization key has been created yet.\n */\nconst big_integer_1 = __importDefault(require(\"big-integer\"));\nconst MTProtoState_1 = require(\"./MTProtoState\");\nconst Helpers_1 = require(\"../Helpers\");\nconst errors_1 = require(\"../errors\");\nconst extensions_1 = require(\"../extensions\");\n/**\n * MTProto Mobile Protocol plain sender (https://core.telegram.org/mtproto/description#unencrypted-messages)\n */\nclass MTProtoPlainSender {\n    /**\n     * Initializes the MTProto plain sender.\n     * @param connection connection: the Connection to be used.\n     * @param loggers\n     */\n    constructor(connection, loggers) {\n        this._state = new MTProtoState_1.MTProtoState(undefined, loggers);\n        this._connection = connection;\n    }\n    /**\n     * Sends and receives the result for the given request.\n     * @param request\n     */\n    async send(request) {\n        let body = request.getBytes();\n        let msgId = this._state._getNewMsgId();\n        const m = (0, Helpers_1.toSignedLittleBuffer)(msgId, 8);\n        const b = Buffer.alloc(4);\n        b.writeInt32LE(body.length, 0);\n        const res = Buffer.concat([\n            Buffer.concat([Buffer.alloc(8), m, b]),\n            body,\n        ]);\n        await this._connection.send(res);\n        body = await this._connection.recv();\n        if (body.length < 8) {\n            throw new errors_1.InvalidBufferError(body);\n        }\n        const reader = new extensions_1.BinaryReader(body);\n        const authKeyId = reader.readLong();\n        if (authKeyId.neq((0, big_integer_1.default)(0))) {\n            throw new Error(\"Bad authKeyId\");\n        }\n        msgId = reader.readLong();\n        if (msgId.eq((0, big_integer_1.default)(0))) {\n            throw new Error(\"Bad msgId\");\n        }\n        /** ^ We should make sure that the read ``msg_id`` is greater\n         * than our own ``msg_id``. However, under some circumstances\n         * (bad system clock/working behind proxies) this seems to not\n         * be the case, which would cause endless assertion errors.\n         */\n        const length = reader.readInt();\n        if (length <= 0) {\n            throw new Error(\"Bad length\");\n        }\n        /**\n         * We could read length bytes and use those in a new reader to read\n         * the next TLObject without including the padding, but since the\n         * reader isn't used for anything else after this, it's unnecessary.\n         */\n        return reader.tgReadObject();\n    }\n}\nexports.MTProtoPlainSender = MTProtoPlainSender;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}